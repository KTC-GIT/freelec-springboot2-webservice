# 워크플로우의 이름
name: simple-springboot3-webservice

# 'main' 또는 'master' 브랜치에 'push' 또는 'pull_request'가 발생하면 실행
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

# 실행할 작업
jobs:
  build:
    # GitHub가 제공하는 기본 Ubuntu 최신 환경에서 실행
    runs-on: ubuntu-latest

    steps:
      # (1) 소스 코드 가져오기
      - name: Checkout
        uses: actions/checkout@v4

      # (2) JDK 11 설치 (프로젝트에 맞게 8, 17 등으로 변경)
      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      # [추가] 디버깅을 위해 파일 상태 확인
      - name: Check file details
        run: |
          echo "--- File list ---"
          ls -la
          echo "--- 'file' command output for gradlew ---"
          file ./gradlew
          echo "--- First line of gradlew (showing control chars) ---"
          cat -v ./gradlew | head -n 1

      # [추가] dos2unix 설치
      - name: Install dos2unix
        run: sudo apt-get update && sudo apt-get install -y dos2unix

      # [수정] sed 대신 dos2unix로 줄바꿈 문자 변환
      - name: Fix line endings with dos2unix
        run: dos2unix ./gradlew

      # (3) gradlew 파일에 실행 권한 부여
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      # (4) Gradle로 빌드 실행
      - name: Build with Gradle
        run: ./gradleW clean build